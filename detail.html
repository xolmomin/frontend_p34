<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mahsulot tafsiloti</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        .result-box {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            background: #f9f9f9;
            white-space: pre-wrap;
            font-family: monospace;
        }
    </style>
</head>
<body>
<header>
    <a href="index.html" class="back-btn">‚¨Ö Orqaga</a>
    <h1>Mahsulot nomi 1</h1>
</header>

<main class="product-detail">
    <img src="https://olcha.uz/image/700x700/products/FzRHGJzuK19yTrSsWdjXptFnuLw9KwyBEbdhDfrmkjIEgWcjirkmdmpENR5g.jpg"
         alt="Mahsulot">
    <div class="info">
        <h2>Mahsulot nomi 1</h2>
        <p class="price">120 000 so‚Äòm</p>
        <p class="desc">
            Ushbu mahsulot yuqori sifatli materiallardan tayyorlangan. Zamonaviy dizayn va qulay foydalanishga ega.
        </p>
        <button class="buy-btn">üõí Sotib olish</button>
    </div>

    <!-- Natija chiqariladigan joy -->
    <div class="result-box" id="result"></div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        const initDataUnsafe = tg.initDataUnsafe;
        console.log("Telegram foydalanuvchi ma'lumotlari:", initDataUnsafe);

        // Foydalanuvchi nomini chiqarish
        if (initDataUnsafe.user) {
            document.querySelector("h1").innerText = initDataUnsafe.user.first_name + " uchun mahsulot";
        }

        // Sotib olish tugmasi
        document.querySelector(".buy-btn").addEventListener("click", () => {
            const resultBox = document.getElementById("result");

            // Ma'lumotlarni ekranda ko‚Äòrsatish
            resultBox.textContent =
                "üõç Buyurtma ma'lumotlari\n\n" +
                "üì¶ Mahsulot ID: 1\n" +
                "üë§ Foydalanuvchi ID: " + initDataUnsafe.user?.id + "\n" +
                "üë§ Ism: " + initDataUnsafe.user?.first_name + "\n" +
                (initDataUnsafe.user?.last_name ? "üë§ Familiya: " + initDataUnsafe.user.last_name + "\n" : "") +
                (initDataUnsafe.user?.username ? "üîó Username: @" + initDataUnsafe.user.username + "\n" : "") +
                "üåê Til: " + initDataUnsafe.user?.language_code + "\n" +
                "üïí Auth date: " + initDataUnsafe.auth_date;

            // Serverga ham jo‚Äònatish
            fetch("https://70fc17882c3e.ngrok-free.app/buy", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    product_id: 1,
                    initData: tg.initData   // server tekshirishi uchun original string yuboriladi
                })
            })
            .then(res => res.json())
            .then(data => {
                resultBox.textContent += "\n\n‚úÖ Server javobi:\n" + JSON.stringify(data, null, 2);
            })
            .catch(err => {
                resultBox.textContent += "\n\n‚ùå Xato: " + err;
            });
        });
    </script>
</main>
</body>
</html>
